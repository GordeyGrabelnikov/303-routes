<div class="tabbable">
  <div class="tabbable-header">
    <%= form_tag events_path, method: :get, class: "search-form" do %>
      <%= text_field_tag :search, params[:search], class: "form-control" %>
      <%= select_tag :category, options_from_collection_for_select( Route.published, :id, :name), include_blank: t('helpers.titles.blank_route'), class: "form-control" %>
      <%= submit_tag t('helpers.links.search'), class: "btn btn-info form-control" %>
    <% end %>
    <%= link_to '', new_event_path, class: 'icon icon--big icon--add', title: t('helpers.titles.new', model: t('activerecord.models.event')) %>
  </div>
  <ul class="nav nav-tabs padding-18">
    <li class="active">
      <a data-toggle="tab" href="#home">
        <i class="green ace-icon fa fa-user bigger-120"></i>
        <%= t('helpers.titles.published_event') %>
      </a>
    </li>

    <li>
      <a data-toggle="tab" href="#friends">
        <i class="blue ace-icon fa fa-users bigger-120"></i>
        Events history
      </a>
    </li>

    <li>
      <a data-toggle="tab" href="#user_events">
        <i class="blue ace-icon fa fa-users bigger-120"></i>
        My events
      </a>
    </li>

    <li>
      <% if current_user.present? && current_user.admin?  %>
        <a data-toggle="tab" href="#unpublished_events">
          <i class="orange ace-icon fa fa-rss bigger-120"></i>
          <%= t('helpers.titles.unpublished_event') %>
        </a>
      <% end %>
    </li>
  </ul>

  <div class="tab-content no-border padding-24">
    <div id="home" class="tab-pane in active">
      <table class='table table-striped'>
        <thead>
        <tr>
          <th><%= t('.event_name')%></th>
          <th><%= t('.event_date')%></th>
          <th><%= t('.event_route')%></th>
          <th colspan="1"></th>
        </tr>
        </thead>

        <tbody>
      <%= render(partial: 'published_event', collection: @events.published.includes([:route])) %>
        </tbody>
        </table>
    </div>

    <div id="friends" class="tab-pane">
      <table class='table table-striped'>
        <thead>
        <tr>
          <th><%= t('.event_name')%></th>
          <th><%= t('.event_date')%></th>
          <th><%= t('.event_route')%></th>
          <th colspan="1"></th>
        </tr>
        </thead>

        <tbody>
        <%= render(partial: 'archived_event', collection: @events.archived.includes(%i[route event_average])) %>
        </tbody>
      </table>
    </div>

    <div id="user_events" class="tab-pane">
      <table class='table table-striped'>
        <thead>
        <tr>
          <th><%= t('.event_name')%></th>
          <th><%= t('.event_date')%></th>
          <th><%= t('.event_route')%></th>
          <th colspan="1"></th>
        </tr>
        </thead>

        <tbody>
        <%= render(partial: 'user_event', collection: @events.joins(:events_users).where(events_users: {user: current_user}).includes([:route]))%>
        </tbody>
      </table>
    </div>


    <div id="unpublished_events" class="tab-pane">
      <table class='table table-striped'>
        <thead>
        <tr>
          <th><%= t('.event_name')%></th>
          <th><%= t('.event_date')%></th>
          <th><%= t('.event_route')%></th>
          <th colspan="1"></th>
        </tr>
        </thead>

        <tbody>
      <% if current_user && current_user.admin?%>
        <%= render(partial: 'unpublished_event', collection: @events.unpublished.order(:date).includes([:route])) %>
      <% end %>
        </table>
      <div class="space-12"></div>

      <div class="center">
        <button type="button" class="btn btn-sm btn-primary btn-white btn-round">
          <i class="ace-icon fa fa-rss bigger-150 middle orange2"></i>
          <span class="bigger-110">View more activities</span>

          <i class="icon-on-right ace-icon fa fa-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>
